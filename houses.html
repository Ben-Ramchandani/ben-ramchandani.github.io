set -e

apt-get update && apt-get upgrade
apt-get remove dhcp5
apt-get --no-install-recommends install xserver-xorg xserver-xorg-video-fbdev xinit pciutils xinput xfonts-100dpi xfonts-75dpi xfonts-scalable chromium-browser xdotool unclutter

cat > /home/pi/run_chrome.sh << EOL
#!/bin/bash
(sleep 15 && ./run_after_chrome.sh) &
startx /usr/bin/chromium-browser --window-size=1920,1200 --kiosk --window-position=0,0 --incognito https://notivation.softwire.com
EOL

cat > /home/pi/run_after_chrome.sh << EOL
#!/bin/bash
export DISPLAY=:0
unclutter &
while (true) do
    (xdotool keydown ctrl; xdotool keyup ctrl;) || exit 1;
    sleep 15
done
EOL

chmod +x /home/pi/run_chrome.sh /home/pi/run_after_chrome.sh
echo "/home/pi/run_chrome.sh" >> /home/pi/.bashrc

echo "Script complete. Run ~/run_chrome.sh to test."
